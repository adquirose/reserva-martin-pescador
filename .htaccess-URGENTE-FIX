# ===============================================
# CORS MULTI-PROYECTOS - MARTIN PESCADOR + FUNDO DE HESA
# Soporte para múltiples aplicaciones React
# ===============================================

<IfModule mod_headers.c>
    # CRÍTICO: Limpiar headers heredados del padre
    Header unset Access-Control-Allow-Origin
    Header unset Access-Control-Allow-Methods
    Header unset Access-Control-Allow-Headers
    Header unset Access-Control-Max-Age

    # Para archivos del tour (ambos proyectos)
    <FilesMatch "\.(jpg|jpeg|png|xml|js|swf)$">
        # Detectar origen y establecer variable para cada proyecto
        SetEnvIf Origin "^http://localhost:5173$" CORS_ORIGIN=http://localhost:5173
        SetEnvIf Origin "^https://reserva-martin-pescador\.onrender\.com$" CORS_ORIGIN=https://reserva-martin-pescador.onrender.com
        SetEnvIf Origin "^https://fundo-la-dehesa\.onrender\.com$" CORS_ORIGIN=https://fundo-la-dehesa.onrender.com
        
        # Aplicar headers CORS solo si hay origen válido
        Header always set Access-Control-Allow-Origin "%{CORS_ORIGIN}e" env=CORS_ORIGIN
        Header always set Access-Control-Allow-Methods "GET, HEAD, OPTIONS" env=CORS_ORIGIN
        Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept" env=CORS_ORIGIN
        Header always set Access-Control-Max-Age "86400" env=CORS_ORIGIN
    </FilesMatch>
</IfModule>

# Preflight requests para ambos proyectos
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteCond %{REQUEST_URI} \.(jpg|jpeg|png|xml|js|swf)$ [NC]
    RewriteRule ^(.*)$ - [R=200,L]
</IfModule>

# Cache optimizado
<IfModule mod_expires.c>
    ExpiresActive On
    <FilesMatch "\.(jpg|jpeg|png)$">
        ExpiresDefault "access plus 7 days"
    </FilesMatch>
    <FilesMatch "\.(xml|js)$">
        ExpiresDefault "access plus 1 hour"
    </FilesMatch>
</IfModule>